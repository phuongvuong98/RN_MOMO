'use strict';import{Platform}from'react-native';import{RNCNetInfo,NetInfoEventEmitter}from'./nativeInterface';var DEVICE_CONNECTIVITY_EVENT='netInfo.networkStatusDidChange';var CHANGE_EVENT_NAME='connectionChange';var _subscriptions=new Set();var _isConnectedSubscriptions=new Map();var _latestNetInfo=null;var _eventSubscription=null;function _isConnected(netInfoData){return netInfoData.type!=='none'&&netInfoData.type!=='unknown';}function _listenerHandler(netInfoData){_latestNetInfo=netInfoData;for(var _iterator=_subscriptions,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var _handler=_ref;_handler(_latestNetInfo);}}var NetInfo={Events:{NetworkStatusDidChange:DEVICE_CONNECTIVITY_EVENT},addEventListener:function addEventListener(eventName,handler){if(eventName!==CHANGE_EVENT_NAME){console.warn('Trying to subscribe to unknown event: "'+eventName+'"');return{remove:function remove(){}};}_subscriptions.add(handler);if(_latestNetInfo){handler(_latestNetInfo);}else{NetInfo.getConnectionInfo().then(function(netInfo){_latestNetInfo=netInfo;handler(_latestNetInfo);});}if(_subscriptions.size>0&&!_eventSubscription){_eventSubscription=NetInfoEventEmitter.addListener(DEVICE_CONNECTIVITY_EVENT,_listenerHandler);}return{remove:function remove(){return NetInfo.removeEventListener(eventName,handler);}};},removeEventListener:function removeEventListener(eventName,handler){_subscriptions.delete(handler);if(_subscriptions.size===0&&_eventSubscription){_eventSubscription.remove();_eventSubscription=null;}},clearEventListeners:function clearEventListeners(){for(var _iterator2=_subscriptions,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++];}else{_i2=_iterator2.next();if(_i2.done)break;_ref2=_i2.value;}var _listener=_ref2;NetInfo.removeEventListener(CHANGE_EVENT_NAME,_listener);}},getConnectionInfo:function getConnectionInfo(){return RNCNetInfo.getCurrentConnectivity();},isConnected:{addEventListener:function addEventListener(eventName,handler){var listener=function listener(connection){if(eventName===CHANGE_EVENT_NAME){handler(_isConnected(connection));}};_isConnectedSubscriptions.set(handler,listener);NetInfo.addEventListener(eventName,listener);return{remove:function remove(){return NetInfo.isConnected.removeEventListener(eventName,handler);}};},removeEventListener:function removeEventListener(eventName,handler){var listener=_isConnectedSubscriptions.get(handler);listener&&NetInfo.removeEventListener(eventName,listener);_isConnectedSubscriptions.delete(handler);},fetch:function fetch(){return NetInfo.getConnectionInfo().then(_isConnected);}},isConnectionExpensive:function isConnectionExpensive(){return Platform.OS==='android'?RNCNetInfo.isConnectionMetered():Promise.reject(new Error('Currently not supported on iOS'));}};module.exports=NetInfo;
//# sourceMappingURL=index.js.map